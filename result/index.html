<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://npmcdn.com/react-bootstrap-table/dist/react-bootstrap-table-all.min.css"
    />
    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <!-- Country Selector CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/country-select-js/2.0.1/css/countrySelect.min.css"
    />
    <!-- babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- Transposit SDK -->
    <script src="https://unpkg.com/transposit@1.0.1/dist/bundle.prod.js"></script>
    <script src="https://npmcdn.com/react-bootstrap-table/dist/react-bootstrap-table.min.js"></script>
    <script src="https://rawgit.com/notifyjs/notifyjs/master/dist/notify.js"></script>
    <!-- Country Selector JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/country-select-js/2.0.1/js/countrySelect.min.js"></script>
    <script>
      // These variables in triple curly braces are dynamically injected by Transposit and should not be modified
      const maintainer = "{{{maintainer}}}";
      const applicationName = "{{{applicationName}}}";
      const host = "{{{host}}}";
      const transposit = new Transposit.Transposit(
        maintainer,
        applicationName,
        host
      );
    </script>

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-115438858-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-115438858-2");
    </script>

    <!-- Hotjar Analytics -->
    <script>
      (function(h, o, t, j, a, r) {
        h.hj =
          h.hj ||
          function() {
            (h.hj.q = h.hj.q || []).push(arguments);
          };
        h._hjSettings = { hjid: 1597799, hjsv: 6 };
        a = o.getElementsByTagName("head")[0];
        r = o.createElement("script");
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
      })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
    </script>
  </head>
  <body class="bg-light">
    <script>
      const transposit2 = new Transposit.Transposit(
        // "https://vue.transposit.io"
        "https://vue-management-ui-staging-2ghmp.transposit.io"
      );
    </script>
    <div id="root" class="container mt-3 mt-md-5"></div>

    <script type="text/babel">
      class App extends React.Component {
        render() {
          return <LoginEmail />;
          // return <ListViewTable email="dimkadon123@gmail.com" />;
        }
      }

      class LoginEmail extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            email: null,
            code: null,
            comcode: null,
            codeFlag: false,
            expireAt: null,
            errors: {
              email: "",
              code: ""
            }
          };
        }
        emailCheck = email => {
          transposit2
            .runOperation("query_on_email", { email: email })
            .then(response => {
              if (response.status !== "SUCCESS") {
                throw response;
              }
              $(".email").hide();
              $(".code").show();
              $("#message").text(
                "Please enter the 6 digit code you received via email"
              );
              this.viewLoader();
            })
            .catch(response => {
              console.log(response);
            });
        };
        viewLoader = () => {
          $(".loader").show();
          $(".wrapper").hide();

          setTimeout(function() {
            $(".loader").hide();
            $(".wrapper").show();
          }, 6000);
        };
        verifyCode = (email, code) => {
          transposit2
            .runOperation("query_valid_check", { code: code })
            .then(response => {
              console.log(response);
              if (response.status !== "SUCCESS") {
                alert("Invalid login code.");
                throw response;
              }
              const results = response.result.results;

              if (
                results.length == 1 &&
                results[0].results &&
                results[0].results.email === email
              ) {
                localStorage.setItem("email", email);
                ReactDOM.render(
                  <ListViewTable email={email} />,
                  document.getElementById("root")
                );
              } else {
                alert("Invalid login code.");
              }
            })
            .catch(response => {
              console.log(response);
            });
        };
        validEmailRegex = RegExp(
          /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i
        );
        validateForm = errors => {
          let valid = true;
          Object.values(errors).forEach(
            val => val.length > 0 && (valid = false)
          );
          return valid;
        };
        handleChange = event => {
          event.preventDefault();
          const { name, value } = event.target;
          let errors = this.state.errors;

          switch (name) {
            case "email":
              errors.email = this.validEmailRegex.test(value)
                ? ""
                : "Please enter a correct email";
              break;
            case "code":
              this.state.codeFlag = true;
              this.state.code = value;
            default:
              break;
          }

          this.setState({ errors, [name]: value });
        };

        handleSubmit = event => {
          event.preventDefault();
          if (this.validateForm(this.state.errors)) {
            console.info("Valid Form");

            this.state.codeFlag
              ? this.verifyCode(this.state.email.toLowerCase(), this.state.code)
              : this.emailCheck(this.state.email.toLowerCase());
          } else {
            console.error("Invalid Form");
          }
        };

        render() {
          const { errors } = this.state;

          let style = {};
          style.display = "none";
          return (
            <React.Fragment>
              <div className="wrapper">
                <div className="form-wrapper">
                  <h2>My Vue Order</h2>
                  <form onSubmit={this.handleSubmit} noValidate>
                    <div className="email">
                      <label htmlFor="email">Enter your email below:</label>
                      <input
                        type="email"
                        name="email"
                        onChange={this.handleChange}
                        noValidate
                      />

                      {errors.email.length > 0 && (
                        <span className="error">{errors.email}</span>
                      )}
                    </div>
                    <div className="code" style={style}>
                      <label htmlFor="code">Verification code:</label>
                      <input
                        type="text"
                        name="code"
                        className="input-code"
                        onChange={this.handleChange}
                        noValidate
                      />

                      {errors.code.length > 0 && (
                        <span className="code">{errors.code}</span>
                      )}
                    </div>
                    <div className="info">
                      <small id="message">
                        Please use the same email you used for your order, and
                        verify within 5 minutes.
                      </small>
                    </div>
                    <div className="submit">
                      <button className="loginBtn">Login</button>
                    </div>
                  </form>
                </div>
              </div>
              <div className="loader" style={style}>
                We're sending you an email...
              </div>
            </React.Fragment>
          );
        }
      }

      async function transposit_action(action, params) {
        console.log(localStorage.getItem("email"));
        let res = await transposit2
          .runOperation("query_valid_check", {
            email: localStorage.getItem("email")
          })
          // .runOperation("query_valid_check", { email: "dimkadon123@gmail.com" })
          .then(response => {
            console.log("before check of valid session");
            console.log(response);
            if (response.status !== "SUCCESS") {
              throw response;
            }
            const results = response.result.results;
            console.log("here3");
            console.log(results);
            console.log(results.length == 1);
            const status = results[0].status;
            console.log(status);
            console.log(results[0].results);
            console.log(results[0].results.status);
            if (status === "SUCCESS") {
              return results;
            } else {
              throw response;
            }
          })
          .then(res => {
            console.log("in check of valid session");
            console.log(res);
            if (res.length >= 1) {
              // if (1) {
              let arr_result = transposit2
                .runOperation(action, params)
                .then(response => {
                  console.log(response);
                  if (response.status !== "SUCCESS") {
                    throw response;
                  }

                  const results = response.result.results;
                  return results;
                })
                .catch(response => {
                  console.log(response);
                  return "error";
                });
              // return "timeout";
              return arr_result;
            } else {
              $.notify("Your Session is Timed Out", "info");
              ReactDOM.render(<App />, document.getElementById("root"));
              throw res;
            }
          })
          .catch(response => {
            $.notify("Your Session is Timed Out", "info");
            ReactDOM.render(<App />, document.getElementById("root"));
            console.log(response);
            return "error";
          });

        return res;
      }

      class ListViewTable extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            defaultVal: {},
            provider: [
              {
                AddressCity: "",
                AddressCountry: "",
                AddressHold: false,
                AddressLine1: "",
                AddressLine2: "",
                AddressPhone: "",
                AddressPostalCode: "",
                AddressState: "",
                BackerID: "",
                Email: "",
                FullAddress: "",
                ItemID: "",
                ItemNumber: "",
                ItemNumberofTotalOrderNumber: "",
                Name: "",
                OrderStatus: "",
                PledgedAt: "",
                PrescriptionHold: false,
                Quantity: "",
                SkuCode: "",
                SkuName: ""
              }
            ],
            orderStatus: {
              "0":
                "Unable to complete order due to error. We will follow up with you over email.",
              "1": "Lens details OK, waiting for submission to lens factory.",
              "2": "Lens information sent to lens factory.",
              "3": "Lenses made, awaiting shipment to assembly factory.",
              "4": "Lenses made, arrived at Vue's office.",
              "5": "Lenses delivered to assembly factory, awaiting assembly.",
              "6": "Lenses assembled, awaiting shipping carrier pickup.",
              "7": "Handed off to shipping carrier.",
              "8": "Delivered.",
              "9": "Shipment Error.",
              "10": "Received return, lens/frames will be redone and resent.",
              "999": "Order has been cancelled."
            },
            countryProvider: [
              ["AF", "AFG", 4, "Afghanistan"],
              ["AX", "ALA", 248, "Åland Islands"],
              ["AL", "ALB", 8, "Albania"],
              ["DZ", "DZA", 12, "Algeria"],
              ["AS", "ASM", 16, "American Samoa"],
              ["AD", "AND", 20, "Andorra"],
              ["AO", "AGO", 24, "Angola"],
              ["AI", "AIA", 660, "Anguilla"],
              ["AQ", "ATA", 10, "Antarctica"],
              ["AG", "ATG", 28, "Antigua and Barbuda"],
              ["AR", "ARG", 32, "Argentina"],
              ["AM", "ARM", 51, "Armenia"],
              ["AW", "ABW", 533, "Aruba"],
              ["AU", "AUS", 36, "Australia"],
              ["AT", "AUT", 40, "Austria"],
              ["AZ", "AZE", 31, "Azerbaijan"],
              ["BS", "BHS", 44, "Bahamas"],
              ["BH", "BHR", 48, "Bahrain"],
              ["BD", "BGD", 50, "Bangladesh"],
              ["BB", "BRB", 52, "Barbados"],
              ["BY", "BLR", 112, "Belarus"],
              ["BE", "BEL", 56, "Belgium"],
              ["BZ", "BLZ", 84, "Belize"],
              ["BJ", "BEN", 204, "Benin"],
              ["BM", "BMU", 60, "Bermuda"],
              ["BT", "BTN", 64, "Bhutan"],
              ["BO", "BOL", 68, "Bolivia (Plurinational State of)"],
              ["BQ", "BES", 535, "Bonaire, Sint Eustatius and Saba"],
              ["BA", "BIH", 70, "Bosnia and Herzegovina"],
              ["BW", "BWA", 72, "Botswana"],
              ["BV", "BVT", 74, "Bouvet Island"],
              ["BR", "BRA", 76, "Brazil"],
              ["IO", "IOT", 86, "British Indian Ocean Territory"],
              ["BN", "BRN", 96, "Brunei Darussalam"],
              ["BG", "BGR", 100, "Bulgaria"],
              ["BF", "BFA", 854, "Burkina Faso"],
              ["BI", "BDI", 108, "Burundi"],
              ["KH", "KHM", 116, "Cambodia"],
              ["CM", "CMR", 120, "Cameroon"],
              ["CA", "CAN", 124, "Canada"],
              ["CV", "CPV", 132, "Cabo Verde"],
              ["KY", "CYM", 136, "Cayman Islands"],
              ["CF", "CAF", 140, "Central African Republic"],
              ["TD", "TCD", 148, "Chad"],
              ["CL", "CHL", 152, "Chile"],
              ["CN", "CHN", 156, "China"],
              ["CX", "CXR", 162, "Christmas Island"],
              ["CC", "CCK", 166, "Cocos (Keeling) Islands"],
              ["CO", "COL", 170, "Colombia"],
              ["KM", "COM", 174, "Comoros"],
              ["CG", "COG", 178, "Congo"],
              ["CD", "COD", 180, "Congo (Democratic Republic of the)"],
              ["CK", "COK", 184, "Cook Islands"],
              ["CR", "CRI", 188, "Costa Rica"],
              ["CI", "CIV", 384, "Côte d'Ivoire"],
              ["HR", "HRV", 191, "Croatia"],
              ["CU", "CUB", 192, "Cuba"],
              ["CW", "CUW", 531, "Curaçao"],
              ["CY", "CYP", 196, "Cyprus"],
              ["CZ", "CZE", 203, "Czech Republic"],
              ["DK", "DNK", 208, "Denmark"],
              ["DJ", "DJI", 262, "Djibouti"],
              ["DM", "DMA", 212, "Dominica"],
              ["DO", "DOM", 214, "Dominican Republic"],
              ["EC", "ECU", 218, "Ecuador"],
              ["EG", "EGY", 818, "Egypt"],
              ["SV", "SLV", 222, "El Salvador"],
              ["GQ", "GNQ", 226, "Equatorial Guinea"],
              ["ER", "ERI", 232, "Eritrea"],
              ["EE", "EST", 233, "Estonia"],
              ["ET", "ETH", 231, "Ethiopia"],
              ["FK", "FLK", 238, "Falkland Islands (Malvinas)"],
              ["FO", "FRO", 234, "Faroe Islands"],
              ["FJ", "FJI", 242, "Fiji"],
              ["FI", "FIN", 246, "Finland"],
              ["FR", "FRA", 250, "France"],
              ["GF", "GUF", 254, "French Guiana"],
              ["PF", "PYF", 258, "French Polynesia"],
              ["TF", "ATF", 260, "French Southern Territories"],
              ["GA", "GAB", 266, "Gabon"],
              ["GM", "GMB", 270, "Gambia"],
              ["GE", "GEO", 268, "Georgia"],
              ["DE", "DEU", 276, "Germany"],
              ["GH", "GHA", 288, "Ghana"],
              ["GI", "GIB", 292, "Gibraltar"],
              ["GR", "GRC", 300, "Greece"],
              ["GL", "GRL", 304, "Greenland"],
              ["GD", "GRD", 308, "Grenada"],
              ["GP", "GLP", 312, "Guadeloupe"],
              ["GU", "GUM", 316, "Guam"],
              ["GT", "GTM", 320, "Guatemala"],
              ["GG", "GGY", 831, "Guernsey"],
              ["GN", "GIN", 324, "Guinea"],
              ["GW", "GNB", 624, "Guinea-Bissau"],
              ["GY", "GUY", 328, "Guyana"],
              ["HT", "HTI", 332, "Haiti"],
              ["HM", "HMD", 334, "Heard Island and McDonald Islands"],
              ["VA", "VAT", 336, "Holy See"],
              ["HN", "HND", 340, "Honduras"],
              ["HK", "HKG", 344, "Hong Kong, SAR"],
              ["HU", "HUN", 348, "Hungary"],
              ["IS", "ISL", 352, "Iceland"],
              ["IN", "IND", 356, "India"],
              ["ID", "IDN", 360, "Indonesia"],
              ["IQ", "IRQ", 368, "Iraq"],
              ["IE", "IRL", 372, "Ireland"],
              ["IM", "IMN", 833, "Isle of Man"],
              ["IL", "ISR", 376, "Israel"],
              ["IT", "ITA", 380, "Italy"],
              ["JM", "JAM", 388, "Jamaica"],
              ["JP", "JPN", 392, "Japan"],
              ["JE", "JEY", 832, "Jersey"],
              ["JO", "JOR", 400, "Jordan"],
              ["KZ", "KAZ", 398, "Kazakhstan"],
              ["KE", "KEN", 404, "Kenya"],
              ["KI", "KIR", 296, "Kiribati"],
              ["KR", "KOR", 410, "Korea (Republic of)"],
              ["KW", "KWT", 414, "Kuwait"],
              ["KG", "KGZ", 417, "Kyrgyzstan"],
              ["LA", "LAO", 418, "Lao People's Democratic Republic"],
              ["LV", "LVA", 428, "Latvia"],
              ["LB", "LBN", 422, "Lebanon"],
              ["LS", "LSO", 426, "Lesotho"],
              ["LR", "LBR", 430, "Liberia"],
              ["LY", "LBY", 434, "Libya"],
              ["LI", "LIE", 438, "Liechtenstein"],
              ["LT", "LTU", 440, "Lithuania"],
              ["LU", "LUX", 442, "Luxembourg"],
              ["MO", "MAC", 446, "Macao, SAR"],
              ["MK", "MKD", 807, "Macedonia (the former Yugoslav Republic of)"],
              ["MG", "MDG", 450, "Madagascar"],
              ["MW", "MWI", 454, "Malawi"],
              ["MY", "MYS", 458, "Malaysia"],
              ["MV", "MDV", 462, "Maldives"],
              ["ML", "MLI", 466, "Mali"],
              ["MT", "MLT", 470, "Malta"],
              ["MH", "MHL", 584, "Marshall Islands"],
              ["MQ", "MTQ", 474, "Martinique"],
              ["MR", "MRT", 478, "Mauritania"],
              ["MU", "MUS", 480, "Mauritius"],
              ["YT", "MYT", 175, "Mayotte"],
              ["MX", "MEX", 484, "Mexico"],
              ["FM", "FSM", 583, "Micronesia (Federated States of)"],
              ["MD", "MDA", 498, "Moldova (Republic of)"],
              ["MC", "MCO", 492, "Monaco"],
              ["MN", "MNG", 496, "Mongolia"],
              ["ME", "MNE", 499, "Montenegro"],
              ["MS", "MSR", 500, "Montserrat"],
              ["MA", "MAR", 504, "Morocco"],
              ["MZ", "MOZ", 508, "Mozambique"],
              ["MM", "MMR", 104, "Myanmar"],
              ["NA", "NAM", 516, "Namibia"],
              ["NR", "NRU", 520, "Nauru"],
              ["NP", "NPL", 524, "Nepal"],
              ["NL", "NLD", 528, "Netherlands"],
              ["NC", "NCL", 540, "New Caledonia"],
              ["NZ", "NZL", 554, "New Zealand"],
              ["NI", "NIC", 558, "Nicaragua"],
              ["NE", "NER", 562, "Niger"],
              ["NG", "NGA", 566, "Nigeria"],
              ["NU", "NIU", 570, "Niue"],
              ["NF", "NFK", 574, "Norfolk Island"],
              ["MP", "MNP", 580, "Northern Mariana Islands"],
              ["NO", "NOR", 578, "Norway"],
              ["OM", "OMN", 512, "Oman"],
              ["PK", "PAK", 586, "Pakistan"],
              ["PW", "PLW", 585, "Palau"],
              ["PS", "PSE", 275, "Palestine, State of"],
              ["PA", "PAN", 591, "Panama"],
              ["PG", "PNG", 598, "Papua New Guinea"],
              ["PY", "PRY", 600, "Paraguay"],
              ["PE", "PER", 604, "Peru"],
              ["PH", "PHL", 608, "Philippines"],
              ["PN", "PCN", 612, "Pitcairn"],
              ["PL", "POL", 616, "Poland"],
              ["PT", "PRT", 620, "Portugal"],
              ["PR", "PRI", 630, "Puerto Rico"],
              ["QA", "QAT", 634, "Qatar"],
              ["RE", "REU", 638, "Réunion"],
              ["RO", "ROU", 642, "Romania"],
              ["RU", "RUS", 643, "Russian Federation"],
              ["RW", "RWA", 646, "Rwanda"],
              ["BL", "BLM", 652, "Saint Barthélemy"],
              [
                "SH",
                "SHN",
                654,
                "Saint Helena, Ascension and Tristan da Cunha"
              ],
              ["KN", "KNA", 659, "Saint Kitts and Nevis"],
              ["LC", "LCA", 662, "Saint Lucia"],
              ["MF", "MAF", 663, "Saint Martin (French part)"],
              ["PM", "SPM", 666, "Saint Pierre and Miquelon"],
              ["VC", "VCT", 670, "Saint Vincent and the Grenadines"],
              ["WS", "WSM", 882, "Samoa"],
              ["SM", "SMR", 674, "San Marino"],
              ["ST", "STP", 678, "Sao Tome and Principe"],
              ["SA", "SAU", 682, "Saudi Arabia"],
              ["SN", "SEN", 686, "Senegal"],
              ["RS", "SRB", 688, "Serbia"],
              ["SC", "SYC", 690, "Seychelles"],
              ["SL", "SLE", 694, "Sierra Leone"],
              ["SG", "SGP", 702, "Singapore"],
              ["SX", "SXM", 534, "Sint Maarten (Dutch part)"],
              ["SK", "SVK", 703, "Slovakia"],
              ["SI", "SVN", 705, "Slovenia"],
              ["SB", "SLB", 90, "Solomon Islands"],
              ["SO", "SOM", 706, "Somalia"],
              ["ZA", "ZAF", 710, "South Africa"],
              [
                "GS",
                "SGS",
                239,
                "South Georgia and the South Sandwich Islands"
              ],
              ["SS", "SSD", 728, "South Sudan"],
              ["ES", "ESP", 724, "Spain"],
              ["LK", "LKA", 144, "Sri Lanka"],
              ["SD", "SDN", 729, "Sudan"],
              ["SR", "SUR", 740, "Suriname"],
              ["SJ", "SJM", 744, "Svalbard and Jan Mayen"],
              ["SZ", "SWZ", 748, "Swaziland"],
              ["SE", "SWE", 752, "Sweden"],
              ["CH", "CHE", 756, "Switzerland"],
              ["SY", "SYR", 760, "Syrian Arab Republic"],
              ["TW", "TWN", 158, "Taiwan"],
              ["TJ", "TJK", 762, "Tajikistan"],
              ["TZ", "TZA", 834, "Tanzania, United Republic of"],
              ["TH", "THA", 764, "Thailand"],
              ["TL", "TLS", 626, "Timor-Leste"],
              ["TG", "TGO", 768, "Togo"],
              ["TK", "TKL", 772, "Tokelau"],
              ["TO", "TON", 776, "Tonga"],
              ["TT", "TTO", 780, "Trinidad and Tobago"],
              ["TN", "TUN", 788, "Tunisia"],
              ["TR", "TUR", 792, "Turkey"],
              ["TM", "TKM", 795, "Turkmenistan"],
              ["TC", "TCA", 796, "Turks and Caicos Islands"],
              ["TV", "TUV", 798, "Tuvalu"],
              ["UG", "UGA", 800, "Uganda"],
              ["UA", "UKR", 804, "Ukraine"],
              ["AE", "ARE", 784, "United Arab Emirates"],
              [
                "GB",
                "GBR",
                826,
                "United Kingdom of Great Britain and Northern Ireland"
              ],
              ["US", "USA", 840, "United States of America"],
              ["UM", "UMI", 581, "United States Minor Outlying Islands"],
              ["UY", "URY", 858, "Uruguay"],
              ["UZ", "UZB", 860, "Uzbekistan"],
              ["VU", "VUT", 548, "Vanuatu"],
              ["VE", "VEN", 862, "Venezuela (Bolivarian Republic of)"],
              ["VN", "VNM", 704, "Viet Nam"],
              ["VG", "VGB", 92, "Virgin Islands (British)"],
              ["VI", "VIR", 850, "Virgin Islands (U.S.)"],
              ["WF", "WLF", 876, "Wallis and Futuna"],
              ["EH", "ESH", 732, "Western Sahara"],
              ["YE", "YEM", 887, "Yemen"],
              ["ZM", "ZMB", 894, "Zambia"],
              ["ZW", "ZWE", 716, "Zimbabwe"]
            ],
            addFlag: true,
            progressiveFlag: false
          };

          transposit_action("query_on_email_sql", { email: this.props.email })
            .then(res => {
              console.log(res);
              if (res != "error") {
                const resData = this.convertResult(res);
                this.setState({ defaultVal: resData[0] });
                this.setState({ provider: resData });
                //if (!this.state.progressiveFlag) $('.addInfo').hide();
                //console.log(this.state.provider[0]['AddressCountry'])
                $(".list-add-country")
                  .val(this.state.provider[0]["AddressCountry"])
                  .attr("selected", "selected");
                if (this.state.provider[0].AddressHold === "Yes") {
                  $(".addHoldBtn").text("Release Hold");
                } else {
                  $(".addHoldBtn").text("Place Address Hold");
                }
              } else {
                console.log("time out data");
                //ReactDOM.render(<App/>, document.getElementById("root"));
              }
            })
            .catch(err => console.error(err));
        }

        convertResult = res => {
          let resData = [];
          let skuflag = false;
          for (let i = 0; i < res.length; i++) {
            let temp = {};
            temp["BackerID"] =
              res[i]["BackerID"] !== undefined ? res[i]["BackerID"]["N"] : "";
            temp["AddressCity"] =
              res[i]["AddressCity"] !== undefined
                ? res[i]["AddressCity"]["S"]
                : "";
            temp["AddressCountry"] =
              res[i]["AddressCountry"] !== undefined
                ? res[i]["AddressCountry"]["S"]
                : "";
            temp["AddressHold"] =
              res[i]["AddressHold"] !== undefined
                ? res[i]["AddressHold"]["BOOL"]
                  ? "Yes"
                  : "No"
                : "No";
            temp["AddressLine1"] =
              res[i]["AddressLine1"] !== undefined
                ? res[i]["AddressLine1"]["S"]
                : "";
            temp["AddressLine2"] =
              res[i]["AddressLine2"] !== undefined
                ? res[i]["AddressLine2"]["S"]
                : "";
            //if (temp["AddressLine2"] === 'NoVal') temp["AddressLine2"] = "";
            temp["AddressPostalCode"] =
              res[i]["AddressPostalCode"] !== undefined
                ? res[i]["AddressPostalCode"]["S"] ||
                  res[i]["AddressPostalCode"]["N"]
                : "";
            temp["AddressPhone"] =
              res[i]["AddressPhone"] !== undefined
                ? res[i]["AddressPhone"]["S"] || res[i]["AddressPhone"]["N"]
                : "";
            temp["AddressState"] =
              res[i]["AddressState"] !== undefined
                ? res[i]["AddressState"]["S"]
                : "";
            temp["Email"] =
              res[i]["Email"] !== undefined ? res[i]["Email"]["S"] : "";
            temp["FullAddress"] =
              res[i]["FullAddress"] !== undefined
                ? res[i]["FullAddress"]["S"]
                : "";
            temp["ItemID"] =
              res[i]["ItemID"] !== undefined ? res[i]["ItemID"]["S"] : "";
            temp["ItemNumber"] =
              res[i]["ItemNumber"] !== undefined
                ? res[i]["ItemNumber"]["N"]
                : "";
            temp["ItemNumberofTotalOrderNumber"] =
              res[i]["ItemNumberofTotalOrderNumber"] !== undefined
                ? res[i]["ItemNumberofTotalOrderNumber"]["S"]
                : "";
            temp["Name"] =
              res[i]["Name"] !== undefined ? res[i]["Name"]["S"] : "";
            temp["OrderStatus"] =
              res[i]["OrderStatus"] !== undefined
                ? res[i]["OrderStatus"]["N"]
                : "";
            if (temp["OrderStatus"] >= 6 && temp["OrderStatus"] != 999) {
              console.log("ERR");
              this.state.addFlag = false;
            }
            //temp["OrderStatus"] = 1;

            temp["PledgedAt"] =
              res[i]["PledgedAt"] !== undefined ? res[i]["PledgedAt"]["S"] : "";
            temp["PrescriptionHold"] =
              res[i]["PrescriptionHold"] !== undefined
                ? res[i]["PrescriptionHold"]["BOOL"]
                  ? "Yes"
                  : "No"
                : "No";
            temp["Quantity"] =
              res[i]["Quantity"] !== undefined ? res[i]["Quantity"]["N"] : "";
            temp["SkuCode"] =
              res[i]["SkuCode"] !== undefined ? res[i]["SkuCode"]["S"] : "";
            temp["SkuName"] =
              res[i]["SkuName"] !== undefined ? res[i]["SkuName"]["S"] : "";
            //temp["SkuCode"] = "Progressive";

            temp["Notes"] =
              res[i]["Notes"] !== undefined ? res[i]["Notes"]["S"] : "";
            temp["ODRightSphere_SPH"] =
              res[i]["ODRightSphere_SPH"] !== undefined
                ? res[i]["ODRightSphere_SPH"]["N"]
                : "";
            temp["ODRightCylinder_CYL"] =
              res[i]["ODRightCylinder_CYL"] !== undefined
                ? res[i]["ODRightCylinder_CYL"]["N"]
                : "";
            temp["ODRightAxis"] =
              res[i]["ODRightAxis"] !== undefined
                ? res[i]["ODRightAxis"]["N"]
                : "";
            temp["OSLeftSphere_SPH"] =
              res[i]["OSLeftSphere_SPH"] !== undefined
                ? res[i]["OSLeftSphere_SPH"]["N"]
                : "";
            temp["OSLeftCylinder_CYL"] =
              res[i]["OSLeftCylinder_CYL"] !== undefined
                ? res[i]["OSLeftCylinder_CYL"]["N"]
                : "";
            temp["OSLeftAxis"] =
              res[i]["OSLeftAxis"] !== undefined
                ? res[i]["OSLeftAxis"]["N"]
                : "";
            temp["ODRightADD"] =
              res[i]["ODRightADD"] !== undefined
                ? res[i]["ODRightADD"]["N"]
                : "";
            temp["OSLeftADD"] =
              res[i]["OSLeftADD"] !== undefined ? res[i]["OSLeftADD"]["N"] : "";
            temp["PDOneorTwoNumbers"] =
              res[i]["PDOneorTwoNumbers"] !== undefined
                ? res[i]["PDOneorTwoNumbers"]["S"]
                : "";
            temp["SingularPDValue"] =
              res[i]["SingularPDValue"] !== undefined
                ? res[i]["SingularPDValue"]["N"]
                : "";
            temp["ODRightPupillaryDistance_PD"] =
              res[i]["ODRightPupillaryDistance_PD"] !== undefined
                ? res[i]["ODRightPupillaryDistance_PD"]["N"]
                : "";
            temp["OSLeftPupillaryDistance_PD"] =
              res[i]["OSLeftPupillaryDistance_PD"] !== undefined
                ? res[i]["OSLeftPupillaryDistance_PD"]["N"]
                : "";
            temp["MismatchError"] =
              res[i]["MismatchError"] !== undefined
                ? res[i]["MismatchError"]["S"]
                : "";
            temp["PrescriptionError"] =
              res[i]["PrescriptionError"] !== undefined
                ? res[i]["PrescriptionError"]["S"]
                : "";
            temp["EmailError"] =
              res[i]["EmailError"] !== undefined
                ? res[i]["EmailError"]["S"]
                : "";
            temp["PaymentError"] =
              res[i]["PaymentError"] !== undefined
                ? res[i]["PaymentError"]["S"]
                : "";
            temp["PrescriptionLastModified"] =
              res[i]["PrescriptionLastModified"] !== undefined
                ? res[i]["PrescriptionLastModified"]["S"]
                : "";

            resData.push(temp);

            // console.log(resData);
          }
          return resData;
        };

        dataFormatter = (cell, row) => {
          return this.state.orderStatus[cell];
        };
        errorFormatter = (cell, row) => {
          if (
            row.MismatchError === "" &&
            row.PrescriptionError === "" &&
            row.PaymentError === ""
          )
            return "None";
          let returnVal;
          returnVal =
            row.MismatchError === "" ? "" : row.MismatchError + "<br/>";
          returnVal +=
            row.PrescriptionError === "" ? "" : row.PrescriptionError + "<br/>";
          returnVal +=
            row.PaymentError === ""
              ? ""
              : "Your payment is not complete. Please visit <a href='https://vue.backerkit.com'>vue.backerkit.com</a> to fix your payment error.";
          return returnVal;
        };
        prescriptionDataFormatter = (cell, row) => {
          let btn = (
            <button className="btn btn-primary btn-xs btn-overflow">
              View Prescription
            </button>
          );
          //else if (cell === 'No') btn = <button className='btn btn-primary btn-xs '>Place Hold</button>;
          return btn;
        };

        handleChange = event => {
          event.preventDefault();
          console.log(event.target.name, event.target.value);
          switch (event.target.name) {
            case "list-add-country":
              console.log($(".list-add-country option:selected").val());

              break;
            case "list-add-city":
              break;
            default:
              break;
          }
        };
        handleEdit = event => {
          event.preventDefault();
          //console.log(event.target.name)
          if (event.target.name === "editAddBtn") {
            let editAddBtn = $(".editAddBtn");
            if (this.state.addFlag) {
              if ($("input").attr("disabled")) {
                $("input").removeAttr("disabled");
                $(".list-add-country").removeAttr("disabled");
                editAddBtn.text("Save");
                $(".cancelAddBtn").removeAttr("hidden");
              } else {
                let add_line = $(".list-add-line").val();
                let add_name = $(".list-add-name").val();
                let add_city = $(".list-add-city").val();
                let add_state = $(".list-add-state").val();
                let add_postalcode = $(".list-add-postalcode").val();
                let add_country = $(".list-add-country").val();
                let add_phone = $(".list-add-phone").val();
                let add_line2 = $(".list-add-line2").val();

                if (
                  add_line === "" ||
                  add_name === "" ||
                  add_city === "" ||
                  add_state === "" ||
                  add_postalcode === "" ||
                  add_phone === ""
                ) {
                  $.notify("Please fill out all required fields", "info");
                } else {
                  $("input").attr("disabled", "disabled");
                  $(".list-add-country").attr("disabled", "disabled");
                  $(".cancelAddBtn").attr("hidden", "hidden");
                  editAddBtn.text("Edit");

                  let fsuc = true;
                  for (let i = 0; i < this.state.provider.length; i++) {
                    transposit_action("update_vue_orders", {
                      AddressLine1: add_line,
                      AddressLine2: add_line2,
                      Name: add_name,
                      AddressCity: add_city,
                      AddressState: add_state,
                      AddressPostalCode: add_postalcode,
                      AddressCountry: add_country,
                      AddressPhone: add_phone,
                      BackerID: this.state.provider[i]["BackerID"],
                      ItemNumber: this.state.provider[i]["ItemNumber"]
                    })
                      .then(res => {
                        if (res != "error") {
                          this.state.defaultVal.AddressLine1 = add_line;
                          this.state.defaultVal.Name = add_name;
                          this.state.defaultVal.AddressCity = add_city;
                          this.state.defaultVal.AddressState = add_state;
                          this.state.defaultVal.AddressPostalCode = add_postalcode;
                          this.state.defaultVal.AddressCountry = add_country;
                          this.state.defaultVal.AddressPhone = add_phone;
                          this.state.defaultVal.AddressLine2 = add_line2;
                          if (i == this.state.provider.length - 1 && fsuc)
                            $.notify(
                              "Address Information Changed Successfully",
                              "success"
                            );
                        } else {
                          console.log("timeout update address");
                          fsuc = false;
                        }

                        console.log(res);
                      })
                      .catch(err => console.error(err));
                  }
                }
              }
            } else {
              $.notify(
                "Address can't be changed because the order has already been handed to shipping carrier",
                "info"
              );
            }
          } else if (event.target.name === "cancelAddBtn") {
            $("input").attr("disabled", "disabled");
            $(".editAddBtn").text("Edit Address");
            $(".list-add-country").attr("disabled", "disabled");
            $(".cancelAddBtn").attr("hidden", "hidden");
            this.state.provider[0] = this.state.defaultVal;
            $(".list-add-line").val(this.state.defaultVal["AddressLine1"]);
            $(".list-add-name").val(this.state.defaultVal["Name"]);
            $(".list-add-line2").val(this.state.defaultVal["AddressLine2"]);
            $(".list-add-city").val(this.state.defaultVal["AddressCity"]);
            $(".list-add-state").val(this.state.defaultVal["AddressState"]);
            $(".list-add-postalcode").val(
              this.state.defaultVal["AddressPostalCode"]
            );
            $(".list-add-country").val(this.state.defaultVal["AddressCountry"]);
            $(".list-add-phone").val(this.state.defaultVal["AddressPhone"]);
          } else if (event.target.name === "addHoldBtn") {
            if (this.state.addFlag) {
              let tmp = {};
              if (this.state.provider[0].AddressHold === "No") {
                $(".addHoldBtn").text("Release Hold");
                for (let i = 0; i < this.state.provider.length; i++) {
                  tmp["BackerID"] = this.state.provider[i].BackerID;
                  tmp["ItemNumber"] = this.state.provider[i].ItemNumber;
                  tmp["AddressHold"] = true;
                  transposit_action("update_vue_orders", tmp)
                    .then(res => {
                      if (res != "error") {
                        this.state.provider[i].AddressHold = "Yes";
                        $.notify("Place Address Hold Success", "success");
                      } else {
                        console.log("timeout address hold");
                      }

                      console.log("success");
                    })
                    .catch(err => {
                      console.error(err);
                      return false;
                    });
                }
              } else {
                $(".addHoldBtn").text("Place Address Hold");
                for (let i = 0; i < this.state.provider.length; i++) {
                  tmp["BackerID"] = this.state.provider[i].BackerID;
                  tmp["ItemNumber"] = this.state.provider[i].ItemNumber;
                  tmp["AddressHold"] = false;
                  transposit_action("update_vue_orders", tmp)
                    .then(res => {
                      if (res != "error") {
                        this.state.provider[i].AddressHold = "No";
                        $.notify("Release Hold Success", "success");
                      } else {
                        console.log("timeout address hold");
                      }
                      console.log("success");
                    })
                    .catch(err => {
                      console.error(err);
                      return false;
                    });
                }
              }
            } else {
              $.notify("You can't Hold Address", "info");
            }
          }
          //$('input').removeAttr('disabled');
          //console.log(event.target);
        };

        shouldDisplayHoldOption = orderStatus => {
          if (orderStatus == 0 || orderStatus == 1) {
            return false;
          }

          if (orderStatus >= 2 && orderStatus <= 6) {
            return true;
          }

          // >=7, or invalid
          return false;
        };

        beforeSaveCell = (row, cellName, cellValue) => {
          // do your stuff...

          if (cellName !== "") {
            let tmp = {};
            tmp[cellName] = cellValue === "Yes" ? true : false;
            //if (cellName == 'OrderStatus') tmp[cellName] = 1;
            tmp["BackerID"] = row.BackerID;
            tmp["ItemNumber"] = row.ItemNumber;

            if (
              !this.shouldDisplayHoldOption(row.OrderStatus) &&
              cellName === "PrescriptionHold"
            ) {
              console.log(cellValue);
              return true;
            } else if (
              this.shouldDisplayHoldOption(row.OrderStatus) &&
              cellName === "PrescriptionHold"
            ) {
              console.log(cellValue);
              return "true";
            } else if (cellName === "AddressHold") {
              transposit_action("update_vue_orders", tmp)
                .then(res => {
                  $.notify("Address Hold", "success");
                  return true;
                })
                .catch(err => {
                  console.error(err);
                  return false;
                });
            }
          } else {
            if (cellValue === "save") {
              let tmp = {};
              row.BacerID !== "" ? (tmp["BackerID"] = row.BackerID) : false;
              row.ItemNumber !== ""
                ? (tmp["ItemNumber"] = row.ItemNumber)
                : false;
              // row.ODRightSphere_SPH !=='' ? tmp["ODRightSphere_SPH"] = row.ODRightSphere_SPH : false;
              tmp["OrderStatus"] = row.OrderStatus + "";
              tmp["ODRightSphere_SPH"] = row.ODRightSphere_SPH;
              tmp["ODRightCylinder_CYL"] = row.ODRightCylinder_CYL;
              tmp["ODRightAxis"] = row.ODRightAxis;
              tmp["OSLeftSphere_SPH"] = row.OSLeftSphere_SPH;
              tmp["OSLeftCylinder_CYL"] = row.OSLeftCylinder_CYL;
              tmp["OSLeftAxis"] = row.OSLeftAxis;
              tmp["ODRightADD"] = row.ODRightADD;
              tmp["OSLeftADD"] = row.OSLeftADD;
              tmp["PDOneorTwoNumbers"] = row.PDOneorTwoNumbers;

              tmp["SingularPDValue"] = row.SingularPDValue;
              tmp["ODRightPupillaryDistance_PD"] =
                row.ODRightPupillaryDistance_PD;
              tmp["OSLeftPupillaryDistance_PD"] =
                row.OSLeftPupillaryDistance_PD;
              tmp["MismatchError"] = row.MismatchError;
              tmp["PrescriptionError"] = row.PrescriptionError;
              tmp["EmailError"] = row.EmailError;
              tmp["PaymentError"] = row.PaymentError;
              let current_datetime = new Date();
              let formatted_date =
                current_datetime.getFullYear() +
                "-" +
                (current_datetime.getMonth() + 1) +
                "-" +
                current_datetime.getDate() +
                "T" +
                current_datetime.getHours() +
                ":" +
                current_datetime.getMinutes() +
                ":" +
                current_datetime.getSeconds();
              tmp["PrescriptionLastModified"] = formatted_date;
              tmp["SkuName"] = row.SkuName;
              tmp["SkuCode"] = row.SkuCode;

              // automatically update hold when order status is 2-6
              if (row.OrderStatus >= 2 && row.OrderStatus <= 6) {
                tmp["PrescriptionHold"] = true;
                row.PrescriptionHold = "Yes";
              }
              console.log(tmp);
              transposit_action("update_vue_orders", tmp)
                .then(res => {
                  if (res != "error") {
                    $.notify(
                      "Prescription Detail Information Changed Successfully",
                      "success"
                    );
                    return true;
                  } else {
                    console.log("timeout prescription detail change");
                    return false;
                  }
                })
                .catch(err => {
                  console.error(err);
                  return false;
                });
            } else {
              console.log(row, cellValue);
            }
            return false;
          }
        };
        prescriptionHoldFormatter = (row, value) => {
          console.log(row, value);
          return <button>Place Hold</button>;
        };

        isOrderForGlasses = SkuName => {
          const lowerCase = SkuName.toLowerCase();
          return (
            !lowerCase.includes("shirt") && !lowerCase.includes("charging")
          );
        };

        render() {
          var ReactBsTable = window.BootstrapTable;
          var BootstrapTable = window.ReactBootstrapTable.BootstrapTable;
          var TableHeaderColumn = window.ReactBootstrapTable.TableHeaderColumn;

          const cellEditProp = {
            mode: "click",
            blurToSave: true,
            beforeSaveCell: this.beforeSaveCell
          };
          return (
            <React.Fragment>
              <div>
                <img
                  className="float-md-right ml-md-3"
                  width="64"
                  height="64"
                  data-type="image"
                  itemProp="image"
                  src="images/vuelogo.png"
                ></img>
                <h1>Vue Order Dashboard</h1>
                <p className="text-secondary">
                  Here is a list of your orders. Reach out to{" "}
                  <a href="mailto:support@vueglasses.com">
                    support@vueglasses.com
                  </a>{" "}
                  for questions!
                </p>
                <h4>Address</h4>
              </div>
              <form className="addInfo">
                <div className="form-row">
                  <input
                    type="text"
                    className="list-add-name col-md-6"
                    name="list-add-name"
                    defaultValue={this.state.provider[0]["Name"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="Name*"
                  />
                </div>
                <div className="form-row">
                  <input
                    className="list-add-line col-md-6"
                    name="list-add-line"
                    defaultValue={this.state.provider[0]["AddressLine1"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="Address Line 1*"
                  />
                </div>
                <div className="form-row">
                  <input
                    className="list-add-line2 col-md-6"
                    name="list-add-line2"
                    defaultValue={this.state.provider[0]["AddressLine2"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="Address Line 2"
                  />
                </div>
                <div className="form-row">
                  <input
                    className="list-add-city col-md-3"
                    name="list-add-city"
                    defaultValue={this.state.provider[0]["AddressCity"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="City*"
                  />
                  <input
                    className="list-add-state col-md-3"
                    name="list-add-state"
                    defaultValue={this.state.provider[0]["AddressState"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="State*"
                  />
                </div>
                <div className="form-row">
                  <input
                    className="list-add-postalcode col-md-3"
                    name="list-add-postalcode"
                    defaultValue={this.state.provider[0]["AddressPostalCode"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="Postal Code*"
                  />
                  <select
                    className="list-add-country col-md-3"
                    name="list-add-country"
                    defaultValue={this.state.provider[0]["AddressCountry"]}
                    onChange={this.handleChange}
                    disabled
                  >
                    {this.state.countryProvider.map(obj => (
                      <option value={obj[0]} key={obj[0]}>
                        {obj[3]}
                      </option>
                    ))}
                  </select>
                </div>
                <div className="form-row">
                  <input
                    type="tel"
                    className="list-add-phone col-md-6"
                    name="list-add-phone"
                    defaultValue={this.state.provider[0]["AddressPhone"]}
                    onChange={this.handleChange}
                    disabled
                    placeholder="Phone*"
                  />
                </div>
                <div>
                  {/*
      				        <button className="editAddBtn btn btn-primary" name="editAddBtn" onClick={this.handleEdit}>Edit Address</button>
                      */}
                  <button
                    className="cancelAddBtn btn btn-secondary"
                    name="cancelAddBtn"
                    onClick={this.handleEdit}
                    hidden
                  >
                    Cancel Edit
                  </button>

                  {/*<button className="addHoldBtn btn btn-danger" name="addHoldBtn" onClick={this.handleEdit}>Place Address Hold</button>*/}
                </div>
              </form>
              <div>
                <h4>Glasses</h4>
                <BootstrapTable
                  data={this.state.provider.filter(d => {
                    return this.isOrderForGlasses(d["SkuName"]);
                  })}
                  cellEdit={cellEditProp}
                >
                  <TableHeaderColumn dataField="BackerID" isKey hidden>
                    BackerID
                  </TableHeaderColumn>

                  <TableHeaderColumn
                    dataField="SkuName"
                    editable={false}
                    thStyle={{
                      overflowWrap: "break-word",
                      whiteSpace: "normal",
                      textAlign: "center"
                    }}
                    tdStyle={{
                      verticalAlign: "middle",
                      whiteSpace: "normal",
                      overflowWrap: "break-word"
                    }}
                  >
                    Item
                  </TableHeaderColumn>
                  <TableHeaderColumn
                    dataField=""
                    customEditor={{ getElement: createDetailEditor }}
                    thStyle={{
                      overflowWrap: "break-word",
                      whiteSpace: "normal",
                      textAlign: "center"
                    }}
                    tdStyle={{
                      whiteSpace: "normal",
                      textAlign: "center",
                      verticalAlign: "middle"
                    }}
                    dataFormat={this.prescriptionDataFormatter}
                  >
                    Prescriptions
                  </TableHeaderColumn>

                  <TableHeaderColumn
                    dataField="OrderStatus"
                    thStyle={{
                      overflowWrap: "break-word",
                      whiteSpace: "normal",
                      textAlign: "center"
                    }}
                    tdStyle={{
                      whiteSpace: "normal",
                      textAlign: "center",
                      verticalAlign: "middle",
                      overflowWrap: "break-word"
                    }}
                    dataFormat={this.dataFormatter}
                    editable={false}
                  >
                    Order Status
                  </TableHeaderColumn>
                  <TableHeaderColumn
                    dataField=""
                    editable={false}
                    thStyle={{
                      overflowWrap: "break-word",
                      whiteSpace: "normal",
                      textAlign: "center"
                    }}
                    tdStyle={{
                      whiteSpace: "normal",
                      textAlign: "center",
                      color: "red",
                      verticalAlign: "middle",
                      overflowWrap: "break-word"
                    }}
                    dataFormat={this.errorFormatter}
                  >
                    Errors
                  </TableHeaderColumn>
                </BootstrapTable>
              </div>
              &nbsp;
              <div>
                <h4>Accessories</h4>
                <BootstrapTable
                  data={this.state.provider.filter(d => {
                    return !this.isOrderForGlasses(d["SkuName"]);
                  })}
                  cellEdit={cellEditProp}
                >
                  <TableHeaderColumn dataField="BackerID" isKey hidden>
                    BackerID
                  </TableHeaderColumn>
                  <TableHeaderColumn
                    dataField="SkuName"
                    thStyle={{
                      overflowWrap: "break-word",
                      whiteSpace: "normal",
                      textAlign: "center"
                    }}
                    editable={false}
                  >
                    Item
                  </TableHeaderColumn>
                </BootstrapTable>
              </div>
            </React.Fragment>
          );
        }
      }
      const createDetailEditor = (onUpdate, props) => (
        <DetailEditor onUpdate={onUpdate} {...props} />
      );
      const createPrescriptionEditor = (onUpdate, props) => (
        <PrescriptionEditor onUpdate={onUpdate} {...props} />
      );

      class PrescriptionEditor extends React.Component {
        constructor(props) {
          super(props);
          this.updateData = this.updateData.bind(this);
          this.state = { val: props.defaultValue };

          //this.state = { amount: props.defaultValue.amount, currency: props.defaultValue.currency };
        }
        componentDidMount() {
          if (this.props.row.OrderStatus <= 1) {
            if (this.state.val === "Yes") this.state.val = "No";
            else this.state.val = "Yes";
            let tmp = {};
            tmp["PrescriptionHold"] = this.state.val === "Yes" ? true : false;

            tmp["BackerID"] = this.props.row.BackerID;
            tmp["ItemNumber"] = this.props.row.ItemNumber;
            transposit_action("update_vue_orders", tmp)
              .then(res => {
                if (res != "error") {
                  $.notify("Prescription hold status updated", "success");
                } else {
                  console.log("timeout prescription hold");
                  if (this.state.val === "Yes") this.state.val = "No";
                  else this.state.val = "Yes";
                }

                this.updateData();
              })
              .catch(err => {
                console.error(err);
                return false;
              });
          } else {
            $.notify(
              "Can't hold prescription because glasses have already been sent",
              "warn"
            );
            this.updateData();
          }
        }
        updateData() {
          this.props.onUpdate(this.state.val);
        }
        render() {
          return <span></span>;
        }
      }
      // Editing logic
      class DetailEditor extends React.Component {
        constructor(props) {
          super(props);
          this.updateData = this.updateData.bind(this);
          // this.props.row.OrderStatus = 1;
          this.state = {
            row: props.row,
            open: true,
            data: [],
            dataCyl: [],
            dataAxis: [],
            dataAdd: [],
            dataSinglePD: [],
            dataDualPD: [],
            defaultVal: [],
            progressiveFlag: false,
            errorStatus: false,
            defaultVal: {}
          };
          // this.props.row.PrescriptionError = "Some mismatch error occurs";

          let i;

          this.state.data.push({ key: "", value: "" });
          this.state.dataCyl.push({ key: "", value: "" });
          this.state.dataAxis.push({ key: "", value: "" });
          this.state.dataAdd.push({ key: "", value: "" });
          this.state.dataSinglePD.push({ key: "", value: "" });
          this.state.dataDualPD.push({ key: "", value: "" });
          for (i = -18; i <= 6; i += 0.25) {
            if (i > 0)
              this.state.data.push({
                key: 4 * (i + 18),
                value: "+" + i.toFixed(2)
              });
            else
              this.state.data.push({ key: 4 * (i + 18), value: i.toFixed(2) });
          }
          for (i = -6; i <= 6; i += 0.25) {
            if (i > 0)
              this.state.dataCyl.push({
                key: 4 * (i + 6),
                value: "+" + i.toFixed(2)
              });
            else
              this.state.dataCyl.push({
                key: 4 * (i + 6),
                value: i.toFixed(2)
              });
          }
          for (i = 0; i <= 180; i += 1)
            this.state.dataAxis.push({ key: i, value: i });
          for (i = 0; i <= 3.5; i += 0.25)
            this.state.dataAdd.push({
              key: 4 * i,
              value: i > 0 ? "+" + i.toFixed(2) : i.toFixed(2)
            });
          for (i = 48; i <= 80; i += 0.5)
            this.state.dataSinglePD.push({ key: 2 * i, value: i.toFixed(1) });
          for (i = 24; i <= 40; i += 0.5)
            this.state.dataDualPD.push({ key: 2 * i, value: i.toFixed(1) });
        }
        setDefaultVal() {
          this.state.row.PDOneorTwoNumbers =
            this.state.row.PDOneorTwoNumbers == ""
              ? "One Number"
              : this.state.row.PDOneorTwoNumbers;
          this.state.defaultVal.ODRightCylinder_CYL = this.state.row.ODRightCylinder_CYL;
          this.state.defaultVal.ODRightPupillaryDistance_PD = this.state.row.ODRightPupillaryDistance_PD;
          this.state.defaultVal.ODRightAxis = this.state.row.ODRightAxis;
          this.state.defaultVal.ODRightSphere_SPH = this.state.row.ODRightSphere_SPH;
          this.state.defaultVal.OSLeftAxis = this.state.row.OSLeftAxis;
          this.state.defaultVal.OSLeftCylinder_CYL = this.state.row.OSLeftCylinder_CYL;
          this.state.defaultVal.OSLeftPupillaryDistance_PD = this.state.row.OSLeftPupillaryDistance_PD;
          this.state.defaultVal.OSLeftSphere_SPH = this.state.row.OSLeftSphere_SPH;
          this.state.defaultVal.PDOneorTwoNumbers = this.state.row.PDOneorTwoNumbers;
          this.state.defaultVal.SingularPDValue = this.state.row.SingularPDValue;
          this.state.defaultVal.ODRightADD = this.state.row.ODRightADD;
          this.state.defaultVal.OSLeftADD = this.state.row.OSLeftADD;
          this.state.defaultVal.OrderStatus = this.state.row.OrderStatus;
          this.state.defaultVal.PrescriptionError = this.state.row.PrescriptionError;
        }
        getDefaultVal() {
          this.props.row.ODRightSphere_SPH = this.state.defaultVal.ODRightSphere_SPH;
          this.props.row.ODRightCylinder_CYL = this.state.defaultVal.ODRightCylinder_CYL;
          this.props.row.ODRightAxis = this.state.defaultVal.ODRightAxis;
          this.props.row.ODRightPupillaryDistance_PD = this.state.defaultVal.ODRightPupillaryDistance_PD;
          this.props.row.OSLeftAxis = this.state.defaultVal.OSLeftAxis;
          this.props.row.OSLeftCylinder_CYL = this.state.defaultVal.OSLeftCylinder_CYL;
          this.props.row.OSLeftPupillaryDistance_PD = this.state.defaultVal.OSLeftPupillaryDistance_PD;
          this.props.row.OSLeftSphere_SPH = this.state.defaultVal.OSLeftSphere_SPH;
          this.props.row.PDOneorTwoNumbers = this.state.defaultVal.PDOneorTwoNumbers;
          this.props.row.SingularPDValue = this.state.defaultVal.SingularPDValue;
          this.props.row.ODRightADD = this.state.defaultVal.ODRightADD;
          this.props.row.OSLeftADD = this.state.defaultVal.OSLeftADD;
          this.props.row.OrderStatus = this.state.defaultVal.OrderStatus;
          this.props.row.PrescriptionError = this.state.defaultVal.PrescriptionError;
        }
        checkUpdateStatus() {
          let flag = true;
          if (
            this.state.defaultVal.ODRightCylinder_CYL ==
              this.state.row.ODRightCylinder_CYL &&
            this.state.defaultVal.ODRightPupillaryDistance_PD ==
              this.state.row.ODRightPupillaryDistance_PD &&
            this.state.defaultVal.ODRightAxis == this.state.row.ODRightAxis &&
            this.state.defaultVal.ODRightSphere_SPH ==
              this.state.row.ODRightSphere_SPH &&
            this.state.defaultVal.OSLeftAxis == this.state.row.OSLeftAxis &&
            this.state.defaultVal.OSLeftCylinder_CYL ==
              this.state.row.OSLeftCylinder_CYL &&
            this.state.defaultVal.OSLeftPupillaryDistance_PD ==
              this.state.row.OSLeftPupillaryDistance_PD &&
            this.state.defaultVal.OSLeftSphere_SPH ==
              this.state.row.OSLeftSphere_SPH &&
            this.state.defaultVal.PDOneorTwoNumbers ==
              this.state.row.PDOneorTwoNumbers &&
            this.state.defaultVal.SingularPDValue ==
              this.state.row.SingularPDValue &&
            this.state.defaultVal.ODRightADD == this.state.row.ODRightADD &&
            this.state.defaultVal.OSLeftADD == this.state.row.OSLeftADD
          ) {
            flag = false;
          }

          return flag;
        }

        componentDidMount() {
          this.setDefaultVal();

          $.notify.addStyle("foo", {
            html:
              "<div>" +
              "<div class='clearfix'>" +
              "<div class='title' data-notify-html='title'/>" +
              "<div class='buttons'>" +
              "<button class='no btn btn-primary'>No</button>" +
              "<button class='yes btn btn-danger' data-notify-text='button'></button>" +
              "</div>" +
              "</div>" +
              "</div>"
          });

          //listen for click events from this style
          $(document).on("click", ".notifyjs-foo-base .no", function() {
            //programmatically trigger propogating hide event
            $(this).trigger("notify-hide");
          });
          $(document).on("click", ".notifyjs-foo-base .yes", function() {
            //show button text
            $(".modal-save").text("Save");
            $("input.detail_editor").removeAttr("disabled");
            $("select.detail_editor").removeAttr("disabled");
            //hide notification
            $(this).trigger("notify-hide");
          });
          if (
            this.props.row.SkuCode.toLowerCase().indexOf("progressive") === -1
          ) {
            $(".od-add-detail").hide();
          }
          if (this.props.row.MismatchError !== "") {
            this.props.row.MismatchError = "";
            let tmp = {};
            tmp["MismatchError"] = "";
            tmp["BackerID"] = this.props.row.BackerID;
            tmp["ItemNumber"] = this.props.row.ItemNumber;
            transposit_action("update_vue_orders", tmp)
              .then(res => {
                console.log(res);
              })
              .catch(err => {
                console.error(err);
                return false;
              });
          }

          this.validateError();
          if (this.props.row.PDOneorTwoNumbers.indexOf("Two") >= 0) {
            $(".two-pupil").show();
            $(".one-pupil").hide();
            $(".PDOneorTwoNumbers").val("Two Separate Numbers");
          } else if (this.props.row.PDOneorTwoNumbers.indexOf("One") >= 0) {
            $(".one-pupil").show();
            $(".two-pupil").hide();
            $(".PDOneorTwoNumbers").val("One Number");
          } else {
            if (this.props.row.SingularPDValue > 0) {
              $(".one-pupil").show();
              $(".two-pupil").hide();
              $(".PDOneorTwoNumbers").val("One Number");
              this.props.row.PDOneorTwoNumbers = "One Number";
              this.props.row.OSLeftPupillaryDistance_PD = "";
              this.props.row.ODRightPupillaryDistance_PD = "";
            } else {
              $(".one-pupil").hide();
              $(".two-pupil").show();
              $(".PDOneorTwoNumbers").val("Two Separate Numbers");
              this.props.row.PDOneorTwoNumbers = "Two Separate Numbers";
              this.props.row.SingularPDValue = "";
            }
          }
          console.log(this.props.row);
          // this.props.row.SkuCode = "plano";
          if (
            this.props.row.SkuCode.toLowerCase().indexOf("plano") !== -1 ||
            this.props.row.SkuCode.toLowerCase().indexOf("non-corrective") !==
              -1 ||
            this.props.row.SkuCode.toLowerCase().indexOf("no lenses") !== -1
          ) {
            // this.props.onUpdate('close');
            // $.notify(`Prescription can't be modified. Order Status = ${this.props.row.OrderStatus}`, "info");
            $(".modal-save").hide();
          }
        }
        checkError() {
          console.log("in checkerror");
          let preErr = this.props.row.PrescriptionError;
          let err = this.props.row.PrescriptionError.toLowerCase();
          let sku = this.props.row.SkuCode.toLowerCase();
          let errStr = "for sku: " + sku + ", ";
          const is_progressive = sku.indexOf("progressive") !== -1;
          const is_prescription = sku.indexOf("prescription") !== -1;
          if (!is_progressive) {
            if (
              this.props.row.ODRightADD != "" &&
              this.props.row.OSLeftADD != ""
            ) {
              if (
                !(
                  this.props.row.ODRightADD == 0 &&
                  this.props.row.OSLeftADD == 0
                )
              ) {
                this.props.row.OrderStatus = 0;
                this.props.row.PrescriptionError = "SKU not progressive";
              }
            }
          }
          if (preErr.length >= 1) {
            if (
              err.indexOf("data missing") >= 0 ||
              err.indexOf("data incomplete") >= 0
            ) {
              errStr += "in data missing ";
              if (!is_progressive && !is_prescription) {
                errStr += "in plano";
                this.props.row.PrescriptionError = "";
              } else if (!is_progressive && is_prescription) {
                errStr += "in prescription";
                console.log("error-incheck", errStr);
                if (
                  this.props.row.ODRightSphere_SPH !== "" &&
                  this.props.row.ODRightCylinder_CYL !== "" &&
                  this.props.row.ODRightAxis !== "" &&
                  this.props.row.OSLeftSphere_SPH !== "" &&
                  this.props.row.OSLeftCylinder_CYL !== "" &&
                  this.props.row.OSLeftAxis !== "" &&
                  this.props.row.PDOneorTwoNumbers !== "" &&
                  this.props.row.OSLeftADD !== "" &&
                  this.props.row.ODRightADD !== ""
                ) {
                  if (this.props.row.PDOneorTwoNumbers.indexOf("One") >= 0) {
                    if (this.props.row.SingularPDValue != "") {
                      this.props.row.PrescriptionError = "";
                    }
                  } else {
                    if (
                      this.props.row.ODRightPupillaryDistance_PD != "" &&
                      this.props.row.OSLeftPupillaryDistance_PD != ""
                    ) {
                      this.props.row.PrescriptionError = "";
                    }
                  }

                  // this.props.row.PrescriptionError = '';
                }
              } else if (is_progressive && !is_prescription) {
                errStr += "in progressive";
                if (
                  this.props.row.ODRightSphere_SPH !== "" &&
                  this.props.row.ODRightCylinder_CYL !== "" &&
                  this.props.row.ODRightAxis !== "" &&
                  this.props.row.OSLeftSphere_SPH !== "" &&
                  this.props.row.OSLeftCylinder_CYL !== "" &&
                  this.props.row.OSLeftAxis !== "" &&
                  this.props.row.PDOneorTwoNumbers !== "" &&
                  this.props.row.ODRightADD !== "" &&
                  this.props.row.OSLeftADD !== ""
                ) {
                  this.props.row.PrescriptionError = "";
                }
              } else if (is_progressive && is_prescription) {
                console.log("unknown state");
                console.log(this.props.row);
              }
            } else if (err.indexOf("missing single/double pd") >= 0) {
              errStr += "in pd";
              let pdval = this.props.row.PDOneorTwoNumbers.toLowerCase();
              if (pdval.indexOf("one number") !== -1) {
                if (this.props.row.SingularPDValue !== "")
                  this.props.row.PrescriptionError = "";
              } else {
                if (
                  this.props.row.ODRightPupillaryDistance_PD !== "" &&
                  this.props.row.OSLeftPupillaryDistance_PD !== ""
                )
                  this.props.row.PrescriptionError = "";
              }
            } else if (err.indexOf("missing progressive data") >= 0) {
              if (
                this.props.row.ODRightADD !== "" &&
                this.props.row.OSLeftADD !== ""
              ) {
                this.props.row.PrescriptionError = "";
              }
            } else if (err.indexOf("sku not progressive") >= 0) {
              console.log("in sku not prog");
              // if (!is_progressive) { // clean it up
              //   this.props.row.ODRightADD = '';
              //   this.props.row.OSLeftADD = '';
              //   this.props.row.PrescriptionError = '';
              // }
              if (
                this.props.row.ODRightADD == 0 &&
                this.props.row.OSLeftADD == 0
              ) {
                if (this.props.row.PaymentError == "") {
                  this.props.row.PrescriptionError = "";
                  this.props.row.OrderStatus = 1;
                  console.log("remove sku error");
                } else {
                  this.props.row.PrescriptionError = "";
                  console.log("remove sku error");
                }
              }
            } else if (err.indexOf("data suggests plano") >= 0) {
              if (
                !(
                  this.props.row.ODRightSphere_SPH == 0 &&
                  this.props.row.ODRightCylinder_CYL == 0 &&
                  this.props.row.ODRightAxis == 0 &&
                  this.props.row.OSLeftSphere_SPH == 0 &&
                  this.props.row.OSLeftCylinder_CYL == 0 &&
                  this.props.row.OSLeftAxis == 0 &&
                  this.props.row.PDOneorTwoNumbers == "" &&
                  this.props.row.ODRightADD == 0 &&
                  this.props.row.OSLeftADD == 0 &&
                  this.props.row.SingularPDValue == "" &&
                  this.props.row.ODRightPupillaryDistance_PD == "" &&
                  this.props.row.OSLeftPupillaryDistance_PD == "" &&
                  (is_progressive || is_prescription)
                )
              ) {
                this.props.row.PrescriptionError = "";
              }
            }
          } else {
          }
        }
        validateError() {
          if (
            this.props.row.MismatchError === "" &&
            this.props.row.PrescriptionError === "" &&
            this.props.row.PaymentError === ""
          ) {
            $(".error-detail").hide();
            if (this.props.row.OrderStatus == 0) this.props.row.OrderStatus = 1;
            return true;
          } else if (
            this.props.row.PrescriptionError === "" &&
            this.props.row.PaymentError != ""
          ) {
            console.log("warning: prescription is fine but unpaid error");
            return true;
          } else {
            console.log("error: " + this.props.row.MismatchError);
            console.log("error: " + this.props.row.PrescriptionError);
            if (this.props.row.PrescriptionError == "SKU not progressive")
              return true;
            else return false;
          }
        }
        updateData() {
          console.log("in updte data");

          if ($(".modal-save").text() === "Edit") {
            if (this.canEditPrescription(this.props.row.OrderStatus)) {
              if (this.props.row.OrderStatus >= 2) {
                $.notify(
                  {
                    title:
                      "Your lenses have already been sent to the factory. If you change your prescription, this will add another 5 weeks for them to be remade. Are you sure you want to edit?",
                    button: "Yes"
                  },
                  {
                    style: "foo",
                    autoHide: false,
                    clickToHide: false
                  }
                );
              } else {
                $(".modal-save").text("Save");
                $("input.detail_editor").removeAttr("disabled");
                $("select.detail_editor").removeAttr("disabled");
              }
            } else {
              $.notify(`Prescriptions can no longer be modified.`, "info");
            }
          } else {
            // console.log("before save status", this.props.row.PrescriptionError);
            this.checkError();
            // console.log("save status", this.props.row.PrescriptionError);
            if (this.props.row.PDOneorTwoNumbers === "One Number") {
              if (this.props.row.SingularPDValue === "") {
                $.notify(`Please enter PD values.`, "info");
                return false;
              }
            } else if (
              this.props.row.PDOneorTwoNumbers == "Two Separate Numbers"
            ) {
              if (
                this.props.row.OSLeftPupillaryDistance_PD === "" ||
                this.props.row.ODRightPupillaryDistance_PD === ""
              ) {
                $.notify(`Please enter PD values.`, "info");
                return false;
              }
            }
            if (
              this.props.row.ODRightSphere_SPH == "" ||
              this.props.row.OSLeftSphere_SPH == "" ||
              this.props.row.ODRightCylinder_CYL == "" ||
              this.props.row.OSLeftCylinder_CYL == "" ||
              this.props.row.ODRightAxis == "" ||
              this.props.row.OSLeftAxis == "" ||
              this.props.row.ODRightADD == "" ||
              this.props.row.OSLeftADD == ""
            ) {
              $.notify(
                "Please fill in all values. If you don't have a value for that field, enter 0",
                "info"
              );
              return false;
            }
            if (!this.checkUpdateStatus()) {
              this.setState({ open: false });
              this.getDefaultVal();
              this.props.onUpdate("close");
            } else {
              this.validateError()
                ? this.props.onUpdate("save")
                : $.notify("Please fill out all fields before saving", "error");
            }
          }

          /*if((this.props.row.SkuCode.toLowerCase()).indexOf("progressive") === -1 && (this.props.row.ODRightADD !== '' || this.props.row.OSLeftADD !== '')){
                  console.log("debug0");
                  console.log(this.props.row);
                  console.log("debug1");
                  this.props.row.ODRightADD = '';
                  this.props.row.OSLeftADD = '';
                  console.log("debug2");
                  console.log(this.props.row);
                  if( this.props.row.PrescriptionError.toLowerCase().indexOf("sku not progressive") >= 0) {
                      this.props.row.PrescriptionError = '';
                  }
                }
      */
        }
        close = () => {
          this.setState({ open: false });
          //console.log(this.props.row.Name);
          this.getDefaultVal();
          this.props.onUpdate("close");
        };
        handleChange = e => {
          e.preventDefault();
          if (e.target.name === "SingularPDValue") {
            // if((e.target.value < 40 || e.target.value > 80) && e.target.value >= 10) {
            //   $.notify("Values must between 40 and 80", "warning");
            //   this.state.row[e.target.name] = "";
            //   this.props.row[e.target.name] = "";
            //   }
            // else
            if (e.target.value != "")
              this.state.row[e.target.name] =
                (e.target.value / 2).toFixed(1) + "";
            else this.state.row[e.target.name] = "";
          } else if (
            e.target.name === "ODRightPupillaryDistance_PD" ||
            e.target.name === "OSLeftPupillaryDistance_PD"
          ) {
            // if((e.target.value < 24 || e.target.value > 40) && e.target.value >= 10) {
            //   $.notify("Values must between 24 and 40", "warning");
            //   this.state.row[e.target.name] = "";
            //   this.props.row[e.target.name] = "";
            //   }
            // else
            if (e.target.value != "")
              this.state.row[e.target.name] =
                (e.target.value / 2).toFixed(1) + "";
            else this.state.row[e.target.name] = "";
          } else if (
            e.target.name === "ODRightSphere_SPH" ||
            e.target.name === "OSLeftSphere_SPH"
          ) {
            if (e.target.value != "")
              this.state.row[e.target.name] =
                (e.target.value / 4).toFixed(2) - 18 + "";
            else this.state.row[e.target.name] = "";
          } else if (
            e.target.name === "OSLeftCylinder_CYL" ||
            e.target.name === "ODRightCylinder_CYL"
          ) {
            if (e.target.value != "")
              this.state.row[e.target.name] =
                (e.target.value / 4).toFixed(2) - 6 + "";
            else this.state.row[e.target.name] = "";
          } else if (
            e.target.name === "OSLeftADD" ||
            e.target.name === "ODRightADD"
          ) {
            if (e.target.value != "")
              this.state.row[e.target.name] =
                (e.target.value / 4).toFixed(2) + "";
            else this.state.row[e.target.name] = "";
          } else {
            if (e.target.value != "")
              this.state.row[e.target.name] = e.target.value;
            else this.state.row[e.target.name] = "";
          }
          if (e.target.name === "PDOneorTwoNumbers") {
            console.log(e.target.value);
            if (e.target.value === "One Number") {
              $(".one-pupil").show();
              $(".two-pupil").hide();
              this.props.row.OSLeftPupillaryDistance_PD = "";
              this.props.row.ODRightPupillaryDistance_PD = "";
              $(".ODRightPupillaryDistance_PD detail_editor").val("");
              $(".OSLeftPupillaryDistance_PD detail_editor").val("");
            } else if (e.target.value === "Two Separate Numbers") {
              $(".two-pupil").show();
              $(".one-pupil").hide();
              this.props.row.SingularPDValue = "";
              $(".SingularPDValue detail_editor").val("");
            }
          }
          this.checkError();

          console.log(this.props.row);
        };

        // Logic for editing/hold prescriptions
        canEditPrescription = orderStatus => {
          if (orderStatus == 0 || orderStatus == 1) {
            return true;
          }

          //if (orderStatus >=2 && orderStatus <= 5) {
          //  return true;
          //}

          // >=7, or invalid
          return false;
        };
        renderError() {
          // this.props.row.MismatchError = "Error Occur";
          let errList = [];
          errList.push({ key: "1", value: this.props.row.MismatchError });
          errList.push({ key: "2", value: this.props.row.PaymentError });
          errList.push({ key: "3", value: this.props.row.PrescriptionError });
          // console.log(errList);
          return (
            <React.Fragment>
              <div className="error-wrapper">
                <strong>Error: </strong>
                {errList.map(item => {
                  if (item.value != "")
                    return (
                      <React.Fragment key={item.key}>
                        <label className="error">{item.value}</label>
                        <br />
                      </React.Fragment>
                    );
                  else return "";
                })}
              </div>
            </React.Fragment>
          );
        }
        render() {
          const fadeIn = this.state.open ? "in" : "";
          const display = this.state.open ? "block" : "none";

          return (
            <div
              className={`modal fade ${fadeIn}`}
              id="myModal"
              role="dialog"
              style={{ display }}
            >
              <div className="modal-dialog">
                <div className="modal-content">
                  <div className="modal-header">
                    <h5 className="modal-title">Prescription Details</h5>
                  </div>
                  <div className="modal-body">
                    <div className="container">
                      <div className="row error-detail">
                        {this.renderError()}
                      </div>
                      <div className="row">
                        <strong>Frame: </strong>
                        <label className="detail-glass-info-name">
                          {this.props.row.SkuName}
                        </label>
                      </div>
                      <div className="row">
                        <strong>Prescription Info:</strong>
                      </div>
                      <div className="row">
                        <table className="table-borderless">
                          <thead>
                            <tr>
                              <th scope="col"></th>
                              <th scope="col">SPH</th>
                              <th scope="col">CYL</th>
                              <th scope="col">Axis</th>
                              <th scope="col">ADD</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <th scope="row">OD (Right)</th>
                              <td>
                                <select
                                  disabled
                                  className="ODRightSphere_SPH detail_editor"
                                  name="ODRightSphere_SPH"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.ODRightSphere_SPH == ""
                                      ? ""
                                      : (this.props.row.ODRightSphere_SPH * 1 +
                                          18) *
                                        4
                                  }
                                >
                                  {this.state.data.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="ODRightCylinder_CYL detail_editor"
                                  name="ODRightCylinder_CYL"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.ODRightCylinder_CYL == ""
                                      ? ""
                                      : (this.props.row.ODRightCylinder_CYL *
                                          1 +
                                          6) *
                                        4
                                  }
                                >
                                  {this.state.dataCyl.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="ODRightAxis detail_editor"
                                  name="ODRightAxis"
                                  onChange={this.handleChange}
                                  defaultValue={this.props.row.ODRightAxis}
                                >
                                  {this.state.dataAxis.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="ODRightADD detail_editor"
                                  name="ODRightADD"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.ODRightADD == ""
                                      ? ""
                                      : this.props.row.ODRightADD * 4
                                  }
                                >
                                  {this.state.dataAdd.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                            </tr>
                            <tr>
                              <th scope="row">OS (Left)</th>
                              <td>
                                <select
                                  disabled
                                  className="OSLeftSphere_SPH detail_editor"
                                  name="OSLeftSphere_SPH"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.OSLeftSphere_SPH == ""
                                      ? ""
                                      : (this.props.row.OSLeftSphere_SPH * 1 +
                                          18) *
                                        4
                                  }
                                >
                                  {this.state.data.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="OSLeftCylinder_CYL detail_editor"
                                  name="OSLeftCylinder_CYL"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.OSLeftCylinder_CYL == ""
                                      ? ""
                                      : (this.props.row.OSLeftCylinder_CYL * 1 +
                                          6) *
                                        4
                                  }
                                >
                                  {this.state.dataCyl.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="OSLeftAxis detail_editor"
                                  name="OSLeftAxis"
                                  onChange={this.handleChange}
                                  defaultValue={this.props.row.OSLeftAxis}
                                >
                                  {this.state.dataAxis.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                              <td>
                                <select
                                  disabled
                                  className="OSLeftADD detail_editor"
                                  name="OSLeftADD"
                                  onChange={this.handleChange}
                                  defaultValue={
                                    this.props.row.OSLeftADD == ""
                                      ? ""
                                      : this.props.row.OSLeftADD * 4
                                  }
                                >
                                  {this.state.dataAdd.map(obj => (
                                    <option key={obj.key} value={obj.key}>
                                      {obj.value}
                                    </option>
                                  ))}
                                </select>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div className="row">
                        <div className="col-md-6">
                          <label>Pupillary distance (PD) format: </label>
                        </div>
                        <div className="col-md-6">
                          <select
                            disabled
                            className="PDOneorTwoNumbers detail_editor"
                            name="PDOneorTwoNumbers"
                            onChange={this.handleChange}
                            defaultValue={this.props.row.PDOneorTwoNumbers}
                          >
                            <option key="0" val="One Number">
                              One Number
                            </option>
                            <option key="1" val="Two Separate Numbers">
                              Two Separate Numbers
                            </option>
                          </select>
                        </div>
                      </div>
                      <div className="row">
                        <div className="col-md-6 one-pupil">
                          <label>Pupillary distance (PD): </label>
                        </div>
                        <div className="col-md-6 one-pupil">
                          <select
                            disabled
                            className="SingularPDValue detail_editor"
                            onChange={this.handleChange}
                            name="SingularPDValue"
                            defaultValue={
                              this.props.row.SingularPDValue == ""
                                ? ""
                                : this.props.row.SingularPDValue * 2
                            }
                          >
                            {this.state.dataSinglePD.map(obj => (
                              <option key={obj.key} value={obj.key}>
                                {obj.value}
                              </option>
                            ))}
                          </select>
                        </div>
                        <div className="col-md-3 two-pupil">
                          <label>OD (Right) PD: </label>
                        </div>
                        <div className="col-md-3 two-pupil">
                          <select
                            disabled
                            className="ODRightPupillaryDistance_PD detail_editor"
                            onChange={this.handleChange}
                            name="ODRightPupillaryDistance_PD"
                            defaultValue={
                              this.props.row.ODRightPupillaryDistance_PD == ""
                                ? ""
                                : this.props.row.ODRightPupillaryDistance_PD * 2
                            }
                          >
                            {this.state.dataDualPD.map(obj => (
                              <option key={obj.key} value={obj.key}>
                                {obj.value}
                              </option>
                            ))}
                          </select>
                        </div>
                        <div className="col-md-3 two-pupil">
                          <label>OS (Left) PD: </label>
                        </div>
                        <div className="col-md-3 two-pupil">
                          <select
                            disabled
                            className="OSLeftPupillaryDistance_PD detail_editor"
                            onChange={this.handleChange}
                            name="OSLeftPupillaryDistance_PD"
                            defaultValue={
                              this.props.row.OSLeftPupillaryDistance_PD == ""
                                ? ""
                                : this.props.row.OSLeftPupillaryDistance_PD * 2
                            }
                          >
                            {this.state.dataDualPD.map(obj => (
                              <option key={obj.key} value={obj.key}>
                                {obj.value}
                              </option>
                            ))}
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div className="modal-footer">
                    <button
                      type="button"
                      className="btn btn-primary modal-save"
                      onClick={this.updateData}
                    >
                      Edit
                    </button>

                    <button
                      type="button"
                      className="btn btn-default"
                      onClick={this.close}
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );
        }
      }
      //console.log(ReactBsTable, BootstrapTable, TableHeaderColumn);
      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
